import streamlit as st
from binance.client import Client
import pandas as pd
import time
import requests

# --- CONFIGURACI√ìN DE P√ÅGINA ---
st.set_page_config(page_title="CryptoBot Pro", layout="centered")

# --- SEGURIDAD: LOGIN ---
def check_password():
    if "authenticated" not in st.session_state:
        st.session_state["authenticated"] = False

    if not st.session_state["authenticated"]:
        st.title("üîê Acceso Restringido")
        pwd = st.text_input("Introduce la contrase√±a maestra:", type="password")
        if st.button("Entrar"):
            if pwd == "TuClave123": # <--- CAMBIA TU CONTRASE√ëA AQU√ç
                st.session_state["authenticated"] = True
                st.rerun()
            else:
                st.error("Contrase√±a incorrecta")
        return False
    return True

if check_password():
    # --- INTERFAZ DEL BOT ---
    st.title("ü§ñ Panel de Control Scalper")
    
    # Sidebar para configuraci√≥n
    st.sidebar.header("Configuraci√≥n")
    api_key = st.sidebar.text_input("Binance API Key", type="password")
    api_secret = st.sidebar.text_input("Binance Secret", type="password")
    moneda = st.sidebar.selectbox("Moneda", ["SOLUSDT", "BTCUSDT", "ETHUSDT"])
    
    # M√©tricas en pantalla
    col1, col2, col3 = st.columns(3)
    val_precio = col1.empty()
    val_rsi = col2.empty()
    val_ganancia = col3.empty()
    
    st.write("---")
    consola = st.empty() # Para mostrar logs estilo terminal

    if st.sidebar.button("üöÄ Iniciar Bot"):
        cliente = Client(api_key, api_secret)
        st.success(f"Bot ejecut√°ndose en {moneda}...")
        
        ganancia_total = 0.0
        
        while True:
            try:
                # Obtener precio y RSI (L√≥gica que ya tenemos)
                r = requests.get(f"https://api.binance.com/api/v3/ticker/price?symbol={moneda}").json()
                precio = float(r['price'])
                
                # Actualizar m√©tricas visuales
                val_precio.metric("Precio Actual", f"${precio:,.2f}")
                val_rsi.metric("RSI (5m)", "Calculando...") # Aqu√≠ integrar√≠as la func. obtener_rsi
                val_ganancia.metric("Ganancia Total", f"${ganancia_total:.4f}", delta=f"{ganancia_total}")
                
                time.sleep(10)
            except Exception as e:
                st.error(f"Error: {e}")
                break
